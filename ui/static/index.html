<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>File Organizer</title>
    <style>
      body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; color: #222; }
      .row { display: flex; gap: 24px; flex-wrap: wrap; }
      .card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; flex: 1 1 360px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
      h1 { margin-top: 0; }
      pre { white-space: pre-wrap; background: #fafafa; border: 1px solid #eee; padding: 12px; border-radius: 6px; max-height: 420px; overflow: auto; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
      .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; }
      .ok { background: #e8f6ee; color: #0a8a49; border: 1px solid #bfe7d1; }
      .warn { background: #fff6e5; color: #a56700; border: 1px solid #ffe0a3; }
      .muted { color: #666; }
      button { padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
      button:disabled { opacity: .5; cursor: default; }
    </style>
  </head>
  <body>
    <h1>File Organizer</h1>
    <div class="row">
      <div class="card">
        <h2>Status</h2>
        <div id="status">Loading…</div>
      </div>
      <div class="card">
        <h2>Controls</h2>
        <div class="muted">Use CLI for now (manage_organizer.sh). UI controls coming soon.</div>
        <div style="margin-top:12px;">
          <button disabled>Start</button>
          <button disabled>Stop</button>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:24px;">
      <div class="card">
        <h2>Recent Logs</h2>
        <pre id="logs">Loading…</pre>
      </div>
      <div class="card">
        <h2>Discovered Categories</h2>
        <div id="categories">Loading…</div>
      </div>
    </div>

    <script>
      async function fetchJSON(url) {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      }

      function renderStatus(s) {
        const pill = s.running ? '<span class="pill ok">Running</span>' : '<span class="pill warn">Stopped</span>';
        const pids = s.pids && s.pids.length ? s.pids.join(', ') : '—';
        return `${pill}<div class="muted" style="margin-top:8px">PIDs: ${pids}</div>`;
      }

      function renderCategories(data) {
        const cats = data.categories || {};
        const names = Object.keys(cats);
        if (!names.length) return '<div class="muted">No categories yet.</div>';
        const rows = names.sort().map(name => {
          const c = cats[name];
          const count = c && typeof c.file_count === 'number' ? c.file_count : (c.sample_files ? c.sample_files.length : '—');
          return `<tr><td>${name}</td><td>${count}</td></tr>`;
        }).join('');
        return `<table><thead><tr><th>Name</th><th>Files</th></tr></thead><tbody>${rows}</tbody></table>`;
      }

      async function refresh() {
        try {
          const [status, logs, cats] = await Promise.all([
            fetchJSON('/api/status'),
            fetchJSON('/api/logs?lines=300'),
            fetchJSON('/api/categories')
          ]);
          document.getElementById('status').innerHTML = renderStatus(status);
          document.getElementById('logs').textContent = logs.content || '';
          document.getElementById('categories').innerHTML = renderCategories(cats);
        } catch (e) {
          document.getElementById('status').innerHTML = '<span class="pill warn">Error</span>';
          document.getElementById('logs').textContent = String(e);
          document.getElementById('categories').innerHTML = '<div class="muted">Error</div>';
        }
      }

      refresh();
      setInterval(refresh, 5000);
    </script>
  </body>
  </html>


